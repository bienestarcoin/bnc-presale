<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bienestar Coin (BNC) – Preventa Oficial</title>
  <meta name="description" content="Preventa oficial de Bienestar Coin (BNC) en BNB Smart Chain. 1 USDT = 20 BNC." />

  <!-- Ethers.js v5 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <!-- WalletConnect v2 (UMD correcto) -->
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.11.2/dist/index.umd.min.js"></script>

  <style>
    :root{
      --gold:#d4af37; --gold-2:#f4d35e; --black:#0b0b0b; --card:#151515;
      --text:#eaeaea; --muted:#bdbdbd; --ok:#6ee7b7; --warn:#f59e0b; --err:#f87171;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial;
      background: radial-gradient(1200px 500px at 50% -10%, rgba(212,175,55,.15), transparent 70%), var(--black);
      color:var(--text); min-height:100vh; display:flex; flex-direction:column; align-items:center;
    }
    header{width:100%; max-width:980px; padding:24px 16px 8px; display:flex; align-items:center; gap:14px;}
    header img.logo{ width:56px; height:56px; border-radius:50%; object-fit:cover;
      box-shadow:0 0 0 2px rgba(212,175,55,.35), 0 10px 24px rgba(0,0,0,.4);}
    h1{font-size:clamp(22px,3.5vw,30px); margin:0}
    .sub{ color:var(--muted); margin-top:4px; font-size:14px }
    .card{
      width:100%; max-width:980px; margin:18px 16px; padding:18px;
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00)), var(--card);
      border:1px solid rgba(212,175,55,.25); border-radius:14px;
      box-shadow:0 6px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.02);
    }
    .grid{ display:grid; gap:16px; grid-template-columns: 1fr 1fr; }
    @media (max-width:820px){ .grid{ grid-template-columns:1fr; } }
    .row{display:flex; gap:10px; align-items:center; justify-content:space-between}
    .row label{font-size:13px; color:var(--muted)}
    input[type="number"], input[type="text"]{
      width:100%; background:#0f0f0f; color:var(--text); border:1px solid rgba(212,175,55,.25);
      border-radius:10px; padding:12px 14px; font-size:16px; outline:none;
    }
    input[readonly]{opacity:.85}
    .btn{
      width:100%; padding:12px 16px; font-weight:600; font-size:15px; border:none; border-radius:10px; cursor:pointer;
      background: linear-gradient(90deg, var(--gold), var(--gold-2)); color:#151515; box-shadow:0 8px 24px rgba(212,175,55,.25);
      transition: transform .05s ease, filter .15s ease;
    }
    .btn:hover{ filter:brightness(1.03) } .btn:active{ transform:translateY(1px) }
    .btn.alt{ background:#1d1d1d; color:var(--text); border:1px solid rgba(212,175,55,.25); box-shadow:none; }
    .pill{ display:inline-flex; align-items:center; gap:8px; font-size:13px; padding:8px 12px; border-radius:999px;
      border:1px solid rgba(212,175,55,.25); background:#101010; color:var(--muted); }
    .status{margin-top:12px; font-size:14px} .status.ok{color:var(--ok)} .status.warn{color:var(--warn)} .status.err{color:var(--err)}
    footer{ width:100%; max-width:980px; padding:8px 16px 24px; color:var(--muted); font-size:13px }
    code.addr{color:#ffd166}
  </style>
</head>
<body>

  <header>
    <img class="logo" src="./logo.png" alt="BNC" />
    <div>
      <h1>Bienestar Coin (BNC) – Preventa Oficial</h1>
      <div class="sub">1 USDT = <b>20 BNC</b> · Mín: 5 USDT · Máx: 50,000 USDT · Red: <b>BSC</b></div>
    </div>
  </header>

  <section class="card">
    <div class="grid">
      <div style="display:flex; flex-direction:column; gap:12px">
        <div class="row">
          <button id="btnConnect"   class="btn">Conectar Wallet</button>
          <button id="btnConnectWC" class="btn alt">WalletConnect</button>
          <button id="btnSwitch"    class="btn alt">Cambiar a BSC</button>
        </div>

        <div class="row">
          <span class="pill">Wallet: <b id="walletShort">–</b></span>
          <span class="pill">Red: <b id="chainName">–</b></span>
        </div>

        <label>Monto USDT</label>
        <input id="usdtInput" type="number" min="0" step="0.01" placeholder="Ej. 5" />

        <label>Recibirás BNC</label>
        <input id="bncOutput" type="text" readonly placeholder="0" />
      </div>

      <div style="display:flex; flex-direction:column; gap:12px">
        <button id="btnApprove" class="btn">1) Aprobar USDT</button>
        <button id="btnBuy" class="btn">2) Comprar BNC</button>

        <div id="status" class="status">Estado: –</div>

        <div class="card" style="margin:0; padding:12px">
          <div style="font-size:13px; color:var(--muted); line-height:1.5">
            <div>Contrato <b>BNC</b>: <code class="addr" id="addrBNC"></code></div>
            <div><b>USDT</b>: <code class="addr" id="addrUSDT"></code></div>
            <div><b>Preventa</b>: <code class="addr" id="addrPresale"></code></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>© Bienestar Coin · Esta dApp es de preventa. Revisa siempre la dirección de contrato.</footer>

<script>
/* CONFIGURACIÓN */
const ADDR_BNC     = "0xDa7A76879F12824C5E96985F794CDE4F90869D2E";
const ADDR_USDT    = "0x55d398326f99059fF775485246999027B3197955";
const ADDR_PRESALE = "0xCcAc983D6e111f6f21384E40FA1e305C70844fC4";
const CHAIN_ID     = 56;
const WC_PROJECT_ID = "b4feca4564a2101fb8925873d5186274"; // cambia por tu Project ID real

const ERC20_ABI = [
  "function decimals() view returns (uint8)",
  "function balanceOf(address) view returns (uint256)",
  "function allowance(address owner, address spender) view returns (uint256)",
  "function approve(address spender, uint256 amount) returns (bool)"
];
const PRESALE_ABI = [
  "function buyWithUSDT(uint256 usdtAmount) external",
  "function minUSDT() view returns (uint256)",
  "function maxUSDT() view returns (uint256)",
  "function hardCapUSDT() view returns (uint256)",
  "function rate() view returns (uint256)"
];

let provider, signer, account, wcProvider;
let USDT_DEC=18, BNC_DEC=18;
let RATE_SCALED = ethers.utils.parseUnits("20", 18);

const $ = (id)=>document.getElementById(id);
function setStatus(msg,type=""){ $("status").textContent="Estado: "+msg; $("status").className="status "+(type||""); }
function shortAddr(a){ return a?a.slice(0,6)+"…"+a.slice(-4):"–"; }
function chainName(id){ return Number(id)===56?"BSC":Number(id)===97?"BSC Testnet":"Chain "+id; }

/* Detectar proveedor inyectado */
function getInjectedProvider(){
  if(!window.ethereum) return null;
  if(window.ethereum.providers?.length){
    return window.ethereum.providers.find(p=>p.isMetaMask)||window.ethereum.providers[0];
  }
  return window.ethereum;
}

/* WalletConnect init */
function getWCEthereumProviderInit(){
  if(window.WalletConnectProvider?.EthereumProvider?.init) return window.WalletConnectProvider.EthereumProvider.init;
  if(window.WalletConnectProvider?.default?.init) return window.WalletConnectProvider.default.init;
  if(window.WalletConnectEthereumProvider?.init) return window.WalletConnectEthereumProvider.init;
  if(window.EthereumProvider?.init) return window.EthereumProvider.init;
  return null;
}
async function initWC(){
  if(wcProvider) return wcProvider;
  const wcInit=getWCEthereumProviderInit();
  if(!wcInit) throw new Error("No se encontró el EthereumProvider de WalletConnect.");
  wcProvider=await wcInit({
    projectId: WC_PROJECT_ID,
    chains:[CHAIN_ID],
    rpcMap:{56:"https://bsc-dataseed.binance.org/"},
    showQrModal:true
  });
  return wcProvider;
}

/* Conectar inyectado */
async function connectInjected(){
  try{
    const injected=getInjectedProvider();
    if(!injected) throw new Error("No hay proveedor inyectado.");
    provider=new ethers.providers.Web3Provider(injected,"any");
    await provider.send("eth_requestAccounts",[]);
    signer=provider.getSigner();
    account=await signer.getAddress();
    $("walletShort").textContent=shortAddr(account);
    const net=await provider.getNetwork();
    $("chainName").textContent=chainName(net.chainId);
    setStatus("Wallet conectada.","ok");
  }catch(e){ setStatus("Error: "+(e.message||e),"err"); }
}

/* Conectar WalletConnect */
async function connectWithWC(){
  try{
    const wc=await initWC();
    await wc.enable();
    provider=new ethers.providers.Web3Provider(wc,"any");
    signer=provider.getSigner();
    account=await signer.getAddress();
    $("walletShort").textContent=shortAddr(account);
    const net=await provider.getNetwork();
    $("chainName").textContent=chainName(net.chainId);
    setStatus("Conectado con WalletConnect.","ok");
  }catch(e){ setStatus("Error WC: "+(e.message||e),"err"); }
}

/* Botones */
$("btnConnect").addEventListener("click",connectInjected);
$("btnConnectWC").addEventListener("click",connectWithWC);
</script>
</body>
</html>
